MIPSsim下载：https://files.cnblogs.com/files/jiangxinnju/MIPSsim.zip

## 启动模拟器

双击MIPSsim.exe，即可启动该模拟器。MIPSsim是在Windows操作系统上运行的程序，它需要用.NET运行环境。如果你的机器没有该环境，请先下载和安装"Microsoft .NET Framework 2.0 版可再发行组件包"。

模拟器启动时，自动将自己初始化为默认状态。所设置的默认值为：

* 所有通用寄存器和浮点寄存器为全0；
* 内存清零；
* 流水寄存器为全0；
* 清空时钟图、断点、统计数据；
* 内存大小为4096字节；
* 载入起始地址为0；
* 浮点加法、乘法、除法部件的个数均为1；
* 浮点加法、乘法、除法运算延迟分别为6、7、10个时钟周期；
* 采用流水方式；
* 不采用定向机制；
* 不采用延迟槽；
* 采用符号地址；
* 采用绝对周期计数。
 

当模拟器工作在非流水方式下（配置菜单中的"流水方式"前没有"√"号）时，下面叙述中有关流水段的内容都没有意义，应该忽略之。

## MIPSsim的窗口

在流水方式下，模拟器主界面中共有7个子窗口，它们是：代码窗口、寄存器窗口、流水线窗口、时钟周期图窗口、内存窗口、统计窗口和断点窗口。每一个窗口都可以被收起（变成小图标）、展开、拖动位置和放大/缩小。当要看窗口的全部内容时，可以将其放大到最大。

在非流水方式下，只有代码窗口、寄存器窗口、内存窗口和断点窗口。

### 1. 代码窗口

代码窗口给出内存中代码的列表，每条指令占一行，按地址顺序排列。每行有5列（当全部显示时）：地址、断点标记、指令的机器码、流水段标记和符号指令。如图2.1所示。

![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130531231-52714030.jpg)

图2.1 代码窗口

 

图中不同抹色的行代表相应的指令所处的执行段。黄色代表IF段，绿色代表ID段，红色代表EX段，青色代表MEM段，棕色代表WB段。

该窗口中各列的含义如下：

* 地址：以16进制的形式给出。内存是按字节寻址的，每条指令占4个字节。当采用符号地址时，会在相应的位置给出汇编程序中出现的标号。
* 断点标记：如果在该指令处设有断点，则显示相应的标记。断点标记的形式为B.X（X为段名），表示该断点是设置在该指令的"X"段。例如，若某行的断点标记为"B.EX"，则表示在该指令的EX段设置了断点。
当模拟器工作在非流水方式下时，断点的标记为B。
* 机器码：该行所对应的指令的十六进制机器码。若该行无指令，则仅仅显示4字节数据；
* 流水段标记：表示当该指令正在执行时，它在当前周期该指令所处的流水段。当模拟器工作在非流水方式下时，它没有意义。
* 符号指令：机器代码所对应的符号指令。
 

在该窗口中选中某行（用鼠标左键单击），然后再点击鼠标右键，就会弹出菜单：设置断点，清除断点，它们分别用于在所选指令处设置断点和清除断点。

* 设置断点
选择（点击）要设断点的指令à点击右键à"设置断点"，弹出"设置断点"小对话框，在"段"的下拉框中选择断点所在的流水段（在非流水方式下，不存在该下拉框），单击"确定"即可。

* 清除断点
选择（点击）指令à点击右键à"清除断点"，则设置在该指令处的断点被删除。

### 2. 寄存器窗口

寄存器窗口显示MIPSsim模拟器中的寄存器的内容。共有4组寄存器：通用寄存器、浮点寄存器、特殊寄存器和流水寄存器，分为4栏来显示。每一栏下分别有各自的数据格式选项，如图2.2所示。

 

![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130531821-1451321475.jpg)

图2.2 寄存器窗口

 

#### (1) 通用寄存器

MIPS64有32个64位通用寄存器：R0，R1，…，R31。它们被简称为GPRs（General-Purpose Registers），有时也被称为整数寄存器。R0的值永远是0。

通过数据格式选项，可以选择显示的格式是十进制还是十六进制。

#### (2) 浮点寄存器

共有32个64位浮点数寄存器：F0，F1，…，F31。它们被简称为FPRs（Floating-Point Registers）。它们既可以用来存放32个单精度浮点数（32位），也可以用来存放32个双精度浮点数（64位）。存储单精度浮点数（32位）时，只用到FPR的一半，其另一半没用。

#### (3) 特殊寄存器

特殊寄存器有4个：

* PC：程序计数器（32位）；
* LO：乘法寄存器的低位；
* HI：乘法寄存器的高位；
* FCSR：浮点状态寄存器。

#### (4) 流水寄存器

* IF/ID.IR：流水段IF与ID之间的指令寄存器；
* IF/ID.NPC：流水段IF与ID之间的下一指令程序计数器；
* ID/EX.A：流水段ID与EX之间的第一操作数寄存器；
* ID/EX.B：流水段ID与EX之间的第二操作数寄存器；
* ID/EX.Imm：流水段ID与EX之间的立即数寄存器；
* ID/EX.IR：存放从IF/ID.IR传过来的指令；
* EX/MEM.ALUo：流水段EX与MEM之间的ALU计算结果寄存器；
* EX/MEM.IR：存放从ID/EX.IR传过来的指令；
* MEM/WB.LMD：流水段MEM与WB之间的数据寄存器，用于存放从存储器读出的数据；
* MEM/WB.ALUo：存放从EX/MEM.ALUo传过来的计算结果；
* MEM/WB.IR：存放从EX/MEM.IR传过来的指令。

除了流水寄存器外，其他寄存器都可以修改。只要双击某寄存器所在的行，系统就会弹出一个小对话框。该对话框显示了该寄存器原来的值。在新值框中填入新的值，然后点击"保存"，系统就会将新值写入该寄存器。

### 3. 流水线窗口

流水线窗口显示流水线在当前配置下的组成以及该流水线的各段在当前周期正在处理的指令。如图2.3所示。

非流水方式下，没有该窗口。

![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130532114-1401225638.jpg)

图2.3 流水线窗口

在该窗口中，每一个矩形方块代表一个流水段，它们用不同的颜色填充。在该窗口的左侧是IF到WB段，其右边为浮点部件。浮点部件分有浮点加法部件（fadd）、浮点乘法部件（fmul）和浮点除法部件（fdiv）三种。在菜单"配置"à"常规配置"中修改浮点部件个数，可看到该窗口中对应类型的浮点部件个数会发生相应的变化。

在运行过程中，各段的矩形方块中会显示该段正在处理的指令及其地址（16进制）。当双击某矩形方块时，会弹出窗口显示该段出口处的流水寄存器的内容（16进制）。

### 4. 时钟周期图窗口

该窗口用于显示程序执行的时间关系，画出各条指令执行时所用的时钟周期。非流水方式下，没有该窗口。

以窗口左上为原点，横轴正方向指向右方，表示模拟器先后经过的各个周期（列），纵轴正方向指向下方，表示模拟器中先后执行的各条指令（行）。如图2.4所示。

 
![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130532378-1389870826.jpg)


图2.4 时钟周期图窗口

 

横坐标有相对周期计数和绝对周期计数两种不同的表示形式。在默认的绝对周期计数下，按0、1、2、… 依次递增的顺序计数。而在相对周期计数下，当前周期记为第0个周期，而其余周期（在左边）则按其相对于当前周期的位置，分别记为-1，-2，-3，…等。

在由指令轴和周期轴组成的二维空间下，坐标（n, i）对应的矩形区域表示指令i在第n+1周期时所经过的流水段（假设采用绝对周期计数）。

双击某行时，会弹出一个小窗口，显示该指令在各流水段所进行的处理。

该窗口中还显示定向的情况。这是用箭头来表示的。若在第m周期和第m+1周期间产生从指令i1到指令i2的定向，则在坐标（m, i1）和(m+1, i2)表示的矩形区域之间会有一个箭头。

### 5. 内存窗口

该窗口显示模拟器内存中的内容，左侧一栏为十六进制地址，右侧为数据，如图2.5所示。可以直接通过双击来修改其内容。这时会弹出一个"内存修改"对话框，如图2.6所示。对话框的上部区域为数据类型与格式选择区，通过勾选其中的一项，就可以指定所采用的数据类型与格式。

 
![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130532672-332360338.jpg)


图2.5 内存窗口

 
![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130532985-1305520115.jpg)


图2.6 "内存修改"对话框

 

在该"内存修改"对话框中，地址框最开始显示的是被双击的单元的地址，用户可以直接修改该地址。在新值框中输入新值，然后点击按钮"修改"，模拟器就会把新值写入内存中相应的单元。新值的格式必须与所选的数据类型和格式一致。

"前地址"与"后地址"按钮分别将当前地址减少和增加一个数据长度（字节数），并显示当前地址所指定单元的内容。"前地址"和"后地址"用于连续修改一片的内存数据。"显示"按钮用于显示当前地址所指单元的内容。在修改地址后，点击该按钮就可以显示内存单元的内容。

### 6. 统计窗口

该窗口显示模拟器统计的各项数据。如下所示。

（非流水方式下，没有该窗口）

```
汇总：

执行周期总数：0
ID段执行了0条指令


硬件配置：

内存容量：4096 B
加法器个数：1        执行时间（周期数）：6
乘法器个数：1        执行时间（周期数）7        
除法器个数：1        执行时间（周期数）10        
定向机制：不采用


停顿（周期数）：

RAW停顿：0        占周期总数的百分比：0%
其中：
load停顿：0        占所有RAW停顿的百分比：0%
分支/跳转停顿：0        占所有RAW停顿的百分比：0%
浮点停顿：0        占所有RAW停顿的百分比：0%
WAW停顿：0        占周期总数的百分比：0%
结构停顿：0        占周期总数的百分比：0%
控制停顿：0        占周期总数的百分比：0%
自陷停顿：0        占周期总数的百分比：0%
停顿周期总数：0    占周期总数的百分比：0%


分支指令：

指令条数：0        占指令总数的百分比：0%
其中：
分支成功：0        占分支指令数的百分比：0%
分支失败：0        占分支指令数的百分比：0%

load/store指令：

指令条数：0        占指令总数的百分比：0%
其中：
load：0        占load/store指令数的百分比：0%
store：0        占load/store指令数的百分比：0%

浮点指令：

指令条数：0        占指令总数的百分比：0%
其中：
加法：0        占浮点指令数的百分比：0%
乘法：0        占浮点指令数的百分比：0%
除法：0        占浮点指令数的百分比：0%

自陷指令：

指令条数：0        占指令总数的百分比：0%
```

### 7. 断点窗口

断点一般是指指定的一条指令，当程序执行到该指令时，会中断执行，暂停在该指令上。在本模拟器中，断点可以设定在某条指令的某一个流水段上（如果是在流水方式下）。当该指令执行到相应的流水段时，会中断执行。

断点窗口列出当前已经设置的所有断点，每行一个。每行由3部分构成：地址（16进制），流水段名称，符号指令。如图2.7所示。（在非流水方式下，"段"没有意义）

 

![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130533326-196798059.jpg)

图2.7 断点窗口

 

该窗口上方有四个按钮：添加、删除、全部删除、修改。

* 添加
单击"添加"，会弹出小对话框"设置断点"，在"地址"框中输入断点的十六进制地址，在"段"的下拉框中选择在哪个流水段中断（非流水方式下，不需要该操作，下同），单击"确定"即可。

* 删除
选中某个断点（单击断点列表中相应的一项），单击"删除"，则该断点被清除。

* 全部删除
单击"全部删除"，所有断点都将被清除。

* 修改
选中某个断点，单击"修改"，会弹出小对话框"设置断点"，在"地址"框中输入断点的地址，在"段"的下拉框中选择在哪个流水段中断，单击"确定"即可将原断点修改为新设断点。

## MIPSsim的菜单

### 1. 文件菜单

文件菜单如下所示：


![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130533607-1575400217.jpg)
 

#### (1) CPU复位

将模拟器中CPU的状态复位为默认值。

#### (2) 全部复位

将整个模拟器的状态复位为默认值。模拟器启动时，也是将状态设置为默认值。

#### (3) 载入程序

将被模拟程序载入模拟器的内存。被模拟程序可以是汇编程序（.s文件），也可以是汇编后的代码（.bin文件）。点击该菜单后，系统将弹出"载入"对话框，选择要载入的文件，然后点击"打开"。如果是.s文件，系统会对该文件进行汇编。若汇编过程无错误，则将产生的二进制代码载入至模拟器的内存；若有错误，则报告错误信息。如果是.bin文件，则直接将该文件的内容载入到模拟器内存。

被载入程序在内存中连续存放，其起始地址默认为0。该起始地址可以从"代码"菜单中的"载入起始地址"来查看和修改。修改时，如果输入的地址不是4的整数倍，模拟器会自动将其归整为4的整数倍。

#### (4)退出

退出模拟器。

### 2. 执行菜单

该菜单提供了对模拟器执行程序进行控制的功能。在下面的执行方式中，除了单步执行，当遇到断点或者用户手动中止（用"中止"菜单项）时，模拟器将立即暂停执行。

 

在流水方式下，执行菜单如下所示：

![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130533952-729945491.jpg)

 

在非流水方式下，执行菜单如下所示：


![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130534322-1468675628.jpg)
 

#### （1）单步执行一个周期

执行一个时钟周期，然后暂停。其快捷键为F7。该菜单仅出现在流水方式下。

#### （2）撤销上一个周期

模拟器回退一个时钟周期，即恢复到执行该周期之前的状态。其快捷键为F8。该菜单仅出现在流水方式下。

#### （3）执行多个周期

执行多个时钟周期，然后暂停。点击该菜单后，系统会弹出一个小对话框，由用户指定要执行的周期的个数。该菜单仅出现在流水方式下。

#### （4）连续执行

从当前状态开始连续执行程序，直到程序结束或遇到断点或用户手动中止。

#### （5）执行到…

点击该菜单项后，系统会弹出一个"设定终点"小对话框，由用户指定此次执行的终点，即在哪条指令的哪个流水段暂停。点击"确定"后，模拟器即开始执行程序，直到到达终点位置或遇到断点或用户手动中止。所输入的终点地址将被归整为4的整数倍。

#### （6） 中止

点击该菜单项后，模拟器会立即暂停执行。当模拟器执行程序出现长期不结束的状况时，可用该菜单强行使模拟器停止执行。

#### （7）单步执行一条指令

执行一条指令，然后暂停。该指令的地址由当前的PC给出。其快捷键为F7。该菜单仅出现在非流水方式下。

#### （8）撤销上一条指令

模拟器回退一条指令，即恢复到执行该指令之前的状态。其快捷键为F8。该菜单仅出现在非流水方式下。

#### （9） 执行多条指令

执行多条指令，然后暂停。点击该菜单项后，系统会弹出一个小对话框，由用户指定要执行的指令的条数。

### 3. 内存菜单

该菜单下有3项：显示，修改，符号表。

#### （1）显示

该菜单项用于设置显示内存的值的数据类型与格式。点击该菜单项后，系统会弹出"内存显示"对话框，如图3.1所示。在选定所要的数据类型与格式后，单击"确定"按钮，内存窗口中的数据就会按指定的数据类型与格式显示。

 
![](https://raw.githubusercontent.com/jiangxincode/PicGo/master/611264-20181209130534605-1081870238.jpg)


图3.1 内存显示窗口

 

####  (2) 修改

该菜单项用于对内存的值进行修改。点击该菜单项后，系统会弹出"内存修改"对话框，该对话框与图2.6的"内存修改"相同。请参见相关的论述。

#### (3) 符号表

该菜单项用于显示符号表。符号表中列出了当前被执行的程序中各符号的地址（内存地址）。

### 4. 代码菜单

#### (1) 载入起始地址

该菜单项用于显示和修改代码载入内存的起始地址。如果要修改，只要在弹出的"载入起始地址"对话框中输入新的地址，然后点击"确认"即可。

#### (2) 设置断点

点击该菜单项，会弹出"设置断点"小对话框，输入断点地址，并在"段"的下拉框中选择断点所在的流水段（在非流水方式下，不存在该下拉框），单击"确定"即可。

#### (3) 取消断点

在代码窗口中选择某条指令，然后点击该菜单项，则设置在该指令处的断点被删除。

#### (4) 清除所有断点

清除所有断点。

### 5. 配置菜单

配置菜单用于修改模拟器的配置。需要注意的是：修改配置将会使模拟器复位。

配置菜单如下所示：



#### (1) 常规配置

该菜单项用于查看和设置以下参数：（其默认值见"一、启动程序"）

* 内存容量；
* 浮点加法运算部件个数
* 浮点乘法运算部件个数
* 浮点除法运算部件个数
* 浮点加法运算延迟周期数
* 浮点乘法运算延迟周期数
* 浮点除法运算延迟周期数

如果要修改这些参数，只要直接修改，然后点击"确定"按钮即可。

#### (2) 流水方式

"流水方式"开关。当该项被勾选（即其前面有个"√"号）时，模拟器按流水方式工作，能模拟流水线的工作过程。否则（即没有被勾选）就是按串行方式执行程序。

该项的勾选和去选（即去掉其前面的"√"号）都是通过点击该项来实现的。下同。

当从流水方式切换为非流水方式（或相反）时，系统将强行使模拟器的状态复位。

#### (3) 符号地址

"符号地址"开关。当该项被勾选时，代码窗口中的代码将显示原汇编程序中所采用的标号。否则（即没有被勾选）就不显示。

#### (4) 绝对周期计数

"绝对周期计数"开关。当该项被勾选时，时钟周期图窗口中的横坐标将显示为绝对周期，即时钟周期按0、1、2、… 顺序递增的顺序计数。否则（即没有被勾选）就按相对周期计数，即把当前周期记为第0个周期，而其余周期（在左边）则按其相对于当前周期的位置，分别记为-1，-2，-3，…等。

在非流水方式下，该菜单项不起作用（变灰）。

#### (5) 定向

"定向"开关，用于指定是否采用定向技术。当该项被勾选时，模拟器在执行程序时将采用定向技术。否则就不采用。

在非流水方式下，该菜单项不起作用（变灰）。

#### (6) 延迟槽

"延迟槽"开关，用于指定是否采用延迟分支技术。当该项被勾选时，模拟器在执行程序时将采用一个延迟槽。否则就不采用。

在非流水方式下，该菜单项不起作用（变灰）。

#### (7) 载入配置

用于将一个配置文件(.cfg)载入模拟器，模拟器将按该文件进行配置并复位。点击该菜单项，系统将弹出"打开"对话框，让用户指定所要载入的配置文件。

#### (8) 保存配置

用于将模拟器当前的配置保存到一个配置文件(.cfg)中，以便以后重用。点击该菜单项，系统将弹出"保存文件"对话框，让用户指定配置文件的名称和位置。

### 6. 窗口菜单

#### (1) 平铺

将当前已打开的子窗口平铺在主窗口中。

#### (2) 层叠

将当前已打开的子窗口层叠在主窗口中。

#### (3) 打开所有

将所有子窗口都打开。

#### (4) 收起所有

将所有子窗口最小化。

#### (5) 选择子窗口

在该菜单中还列出了所有的子窗口的名称，选择其中的任一个，将使该窗口被选中，并被提到最上层。

### 7. 帮助菜单

该菜单下有两项："帮助"和"关于MIPSsim"。前者提供用户手册，后者给出关于MIPSsim的版权信息和设计开发者信息。

 